<!DOCTYPE html>
<html lang="zh-HK">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Dashboard - æ•™æœƒç¥ˆç¦±ç‰†</title>
    <link rel="stylesheet" href="/css/style.css">
    <style>
        .tabs {
            display: flex;
            gap: 0.5rem;
            margin-bottom: 1rem;
            flex-wrap: wrap;
        }

        .tab {
            padding: 0.5rem 1rem;
            border-radius: 20px;
            background: #e0e0e0;
            color: #333;
            text-decoration: none;
            font-size: 0.9rem;
            cursor: pointer;
            border: none;
        }

        .tab.active {
            background: var(--color-primary);
            color: white;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .expiry-badge {
            font-size: 0.75rem;
            padding: 2px 8px;
            border-radius: 10px;
            margin-left: 0.5rem;
        }

        .expiry-soon {
            background: #fff3e0;
            color: #e65100;
        }

        .expiry-ok {
            background: #e8f5e9;
            color: #2e7d32;
        }
    </style>
</head>

<body>
    <header class="header">
        <h1>ğŸ™ æ•™æœƒç¥ˆç¦±ç‰†</h1>
        <p>ç®¡ç†å¾Œå°</p>
    </header>

    <nav class="nav">
        <a href="/">ğŸ“– ç¥ˆç¦±ç‰†</a>
        <a href="/submit">âœï¸ æäº¤ä»£ç¦±</a>
        <a href="/admin" class="active">âš™ï¸ ç®¡ç†å¾Œå°</a>
        <a href="/admin/digest">ğŸ“‹ ç”Ÿæˆæ‘˜è¦</a>
        <a href="/admin/settings">ğŸ‘¥ è¨­å®š</a>
    </nav>

    <main class="main">
        <div class="admin-header">
            <h2>âš™ï¸ ç®¡ç†å¾Œå°</h2>
            <div class="admin-actions">
                <span style="color: var(--text-secondary); margin-right: 0.5rem;">ğŸ‘¤ <%= admin.username %></span>
                <form method="POST" action="/admin/logout" style="display: inline;">
                    <input type="hidden" name="_csrf" value="<%= csrfToken %>">
                    <button type="submit" class="btn btn-outline btn-sm">ç™»å‡º</button>
                </form>
            </div>
        </div>

        <div class="stats fade-in">
            <div class="stat-card">
                <div class="stat-number">
                    <%= pendingCount %>
                </div>
                <div class="stat-label">å¾…å¯©æ‰¹</div>
            </div>
            <div class="stat-card">
                <div class="stat-number">
                    <%= approvedCount %>
                </div>
                <div class="stat-label">å·²æ‰¹å‡†</div>
            </div>
            <div class="stat-card">
                <div class="stat-number">
                    <%= expiredCount %>
                </div>
                <div class="stat-label">å·²éæœŸ</div>
            </div>
            <div class="stat-card">
                <div class="stat-number">
                    <%= rejectedCount %>
                </div>
                <div class="stat-label">å·²æ‹’çµ•</div>
            </div>
        </div>

        <!-- Tabs -->
        <div class="tabs">
            <button type="button" class="tab active" data-tab="pending">ğŸ“‹ å¾…å¯©æ‰¹ (<%= pendingCount %>)</button>
            <button type="button" class="tab" data-tab="approved">âœ… å·²æ‰¹å‡† (<%= approvedCount %>)</button>
            <button type="button" class="tab" data-tab="expired">â° å·²éæœŸ (<%= expiredCount %>)</button>
            <button type="button" class="tab" data-tab="rejected">âŒ å·²æ‹’çµ• (<%= rejectedCount %>)</button>
        </div>

        <!-- Pending Tab -->
        <section id="pending" class="tab-content active fade-in">
            <% if (pendingPrayers.length===0) { %>
                <div class="empty-state">
                    <div class="empty-state-icon">âœ…</div>
                    <p class="empty-state-text">æš«ç„¡å¾…å¯©æ‰¹é …ç›®</p>
                </div>
                <% } else { %>
                    <% pendingPrayers.forEach(function(prayer) { %>
                        <article class="card">
                            <div class="card-header">
                                <span class="card-title">
                                    <% if (prayer.display_name) { %>
                                        <%= prayer.display_name %>
                                            <% } else { %>
                                                <span class="prayer-anonymous">åŒ¿å</span>
                                                <% } %>
                                </span>
                                <span class="card-meta">
                                    <%= new Date(prayer.created_at).toLocaleString('zh-HK') %>
                                </span>
                            </div>

                            <div
                                style="font-size: 0.85rem; color: var(--color-primary); margin-bottom: 0.5rem; background: #e3f2fd; padding: 4px 8px; border-radius: 4px; display: inline-block;">
                                â±ï¸ ç”³è«‹é¡¯ç¤ºæ™‚é–“: <%= prayer.duration_days || 7 %> æ—¥
                            </div>

                            <div class="card-content">
                                <%= prayer.content %>
                            </div>
                            <div class="btn-group">
                                <form method="POST" action="/admin/approve/<%= prayer.id %>" style="flex: 1;">
                                    <input type="hidden" name="_csrf" value="<%= csrfToken %>">
                                    <button type="submit" class="btn btn-success btn-block btn-sm">âœ… æ‰¹å‡†</button>
                                </form>
                                <form method="POST" action="/admin/reject/<%= prayer.id %>" style="flex: 1;">
                                    <input type="hidden" name="_csrf" value="<%= csrfToken %>">
                                    <button type="submit" class="btn btn-danger btn-block btn-sm">âŒ æ‹’çµ•</button>
                                </form>
                            </div>
                        </article>
                        <% }); %>
                            <% } %>
        </section>

        <!-- Approved Tab -->
        <section id="approved" class="tab-content fade-in">
            <% if (approvedPrayers.length===0) { %>
                <div class="empty-state">
                    <div class="empty-state-icon">ğŸ“­</div>
                    <p class="empty-state-text">æš«ç„¡å·²æ‰¹å‡†ä»£ç¦±</p>
                </div>
                <% } else { %>
                    <% approvedPrayers.forEach(function(prayer) { const expiresAt=prayer.expires_at ? new
                        Date(prayer.expires_at) : null; const approvedAt=new Date(prayer.approved_at); const now=new
                        Date(); const daysLeft=expiresAt ? Math.ceil((expiresAt - now) / (1000 * 60 * 60 * 24)) : null;
                        const dateRange=expiresAt ? `${approvedAt.toLocaleDateString('zh-HK')} -
                        ${expiresAt.toLocaleDateString('zh-HK')}` : '' ; %>
                        <article class="card prayer-card">
                            <div class="card-header">
                                <span class="card-title">
                                    <% if (prayer.display_name) { %>
                                        <%= prayer.display_name %>
                                            <% } else { %>
                                                <span class="prayer-anonymous">åŒ¿å</span>
                                                <% } %>

                                                    <% if (daysLeft !==null) { %>
                                                        <span
                                                            class="expiry-badge <%= daysLeft <= 2 ? 'expiry-soon' : 'expiry-ok' %>">
                                                            <%= daysLeft %> æ—¥å¾ŒéæœŸ
                                                        </span>
                                                        <% } %>
                                </span>
                                <span class="card-meta">
                                    æ‰¹å‡†æ–¼ <%= approvedAt.toLocaleDateString('zh-HK') %>
                                </span>
                            </div>

                            <% if (dateRange) { %>
                                <div
                                    style="font-size: 0.85rem; color: #666; margin-bottom: 0.5rem; background: #f9f9f9; padding: 4px 8px; border-radius: 4px; display: inline-block;">
                                    ğŸ“… é¡¯ç¤ºæ™‚é–“: <%= dateRange %>
                                </div>
                                <% } %>

                                    <div class="card-content">
                                        <%= prayer.content %>
                                    </div>
                                    <div class="btn-group">
                                        <form method="POST" action="/admin/extend/<%= prayer.id %>" style="flex: 2;">
                                            <input type="hidden" name="_csrf" value="<%= csrfToken %>">
                                            <button type="submit" class="btn btn-outline btn-sm btn-block">â° å»¶é•· 7
                                                æ—¥</button>
                                        </form>
                                        <form method="POST" action="/admin/reject/<%= prayer.id %>" style="flex: 1;"
                                            onsubmit="return confirm('ç¢ºå®šè¦åˆªé™¤ (æ‹’çµ•) æ­¤ä»£ç¦±ï¼Ÿ');">
                                            <input type="hidden" name="_csrf" value="<%= csrfToken %>">
                                            <button type="submit" class="btn btn-danger btn-sm btn-block">ğŸ—‘ï¸
                                                åˆªé™¤</button>
                                        </form>
                                    </div>
                        </article>
                        <% }); %>
                            <% } %>
        </section>

        <!-- Expired Tab -->
        <section id="expired" class="tab-content fade-in">
            <div class="alert alert-info" style="margin-bottom: 1rem;">
                å·²éæœŸçš„ä»£ç¦±å””æœƒå†é¡¯ç¤ºå–ºå…¬é–‹ç¥ˆç¦±ç‰†ã€‚ä½ å¯ä»¥å»¶é•·ä½¢å“‹ã€‚
            </div>
            <% if (expiredPrayers.length===0) { %>
                <div class="empty-state">
                    <div class="empty-state-icon">â°</div>
                    <p class="empty-state-text">æš«ç„¡å·²éæœŸä»£ç¦±</p>
                </div>
                <% } else { %>
                    <% expiredPrayers.forEach(function(prayer) { %>
                        <article class="card" style="opacity: 0.7;">
                            <div class="card-header">
                                <span class="card-title">
                                    <% if (prayer.display_name) { %>
                                        <%= prayer.display_name %>
                                            <% } else { %><span class="prayer-anonymous">åŒ¿å</span>
                                                <% } %>
                                </span>
                                <span class="card-meta">éæœŸæ–¼ <%= new Date(prayer.expires_at).toLocaleDateString('zh-HK')
                                        %></span>
                            </div>
                            <div class="card-content">
                                <%= prayer.content %>
                            </div>
                            <div class="btn-group">
                                <form method="POST" action="/admin/extend/<%= prayer.id %>">
                                    <input type="hidden" name="_csrf" value="<%= csrfToken %>">
                                    <button type="submit" class="btn btn-primary btn-sm">ğŸ”„ é‡æ–°ä¸Šæ¶ (+7 æ—¥)</button>
                                </form>
                            </div>
                        </article>
                        <% }); %>
                            <% } %>
        </section>

        <!-- Rejected Tab -->
        <section id="rejected" class="tab-content fade-in">
            <div class="alert alert-info" style="margin-bottom: 1rem;">
                å·²æ‹’çµ•çš„ä»£ç¦±æœƒä¿ç•™ 60 æ—¥ä½œè¨˜éŒ„ï¼Œä¹‹å¾Œè‡ªå‹•åˆªé™¤ã€‚
            </div>
            <% if (rejectedPrayers.length===0) { %>
                <div class="empty-state">
                    <div class="empty-state-icon">ğŸ—‘ï¸</div>
                    <p class="empty-state-text">æš«ç„¡å·²æ‹’çµ•ä»£ç¦±</p>
                </div>
                <% } else { %>
                    <% rejectedPrayers.forEach(function(prayer) { %>
                        <article class="card" style="opacity: 0.6; border-left: 4px solid var(--color-error);">
                            <div class="card-header">
                                <span class="card-title">
                                    <% if (prayer.display_name) { %>
                                        <%= prayer.display_name %>
                                            <% } else { %><span class="prayer-anonymous">åŒ¿å</span>
                                                <% } %>
                                </span>
                                <span class="card-meta">
                                    æ‹’çµ•æ–¼ <%= new Date(prayer.approved_at).toLocaleDateString('zh-HK') %>
                                        by <%= prayer.approved_by %>
                                </span>
                            </div>
                            <div class="card-content">
                                <%= prayer.content %>
                            </div>
                        </article>
                        <% }); %>
                            <% } %>
        </section>
    </main>

    <footer class="footer">
        <p>æ•™æœƒç¥ˆç¦±ç‰† &copy; <%= new Date().getFullYear() %>
        </p>
    </footer>

    <script>
        document.addEventListener('DOMContentLoaded', function () {
            const tabs = document.querySelectorAll('.tab');
            const contents = document.querySelectorAll('.tab-content');

            function switchTab(tabId) {
                // Update tabs
                tabs.forEach(function (t) {
                    if (t.dataset.tab === tabId) t.classList.add('active');
                    else t.classList.remove('active');
                });

                // Update contents
                contents.forEach(function (c) {
                    if (c.id === tabId) c.classList.add('active');
                    else c.classList.remove('active');
                });
            }

            tabs.forEach(function (tab) {
                tab.addEventListener('click', function () {
                    const tabId = this.dataset.tab;
                    switchTab(tabId);
                });
            });

            // Handle hash navigation
            if (window.location.hash) {
                const tabId = window.location.hash.substring(1);
                if (document.getElementById(tabId)) {
                    switchTab(tabId);
                }
            }
        });
    </script>
</body>

</html>