<%- include('../partials/head', { title: '設定', description: '設定 - 教會祈禱牆' }) %>
<%- include('../partials/header', { heroSubtitle: '設定' }) %>
<%- include('../partials/admin-nav', { activeAdmin: 'settings' }) %>

<main class="main">
  <% if (success) { %>
    <div class="alert alert-success fade-up"><%= success %></div>
  <% } %>
  <% if (error) { %>
    <div class="alert alert-error fade-up"><%= error %></div>
  <% } %>

  <!-- Admin List -->
  <div class="section-card fade-up">
    <h2 class="section-title">管理員帳號</h2>
    <table class="table">
      <thead>
        <tr>
          <th>帳號</th>
          <th>建立日期</th>
          <th style="text-align:right;">操作</th>
        </tr>
      </thead>
      <tbody>
        <% admins.forEach(function(a) { %>
          <tr>
            <td>
              <%= a.username %>
              <% if (a.id === currentAdminId) { %>
                <span class="text-muted" style="font-size:0.8rem;">（你）</span>
              <% } %>
            </td>
            <td class="text-muted"><%= new Date(a.created_at).toLocaleDateString('zh-HK') %></td>
            <td style="text-align:right;">
              <% if (a.id !== currentAdminId) { %>
                <form method="POST" action="/admin/remove-admin/<%= a.id %>" class="inline-form"
                  onsubmit="return confirm('確定要移除此管理員？');">
                  <input type="hidden" name="_csrf" value="<%= csrfToken %>">
                  <button type="submit" class="btn btn-danger btn-sm">移除</button>
                </form>
              <% } %>
            </td>
          </tr>
        <% }); %>
      </tbody>
    </table>
  </div>

  <!-- Add Admin -->
  <div class="section-card fade-up">
    <h2 class="section-title">新增管理員</h2>
    <form method="POST" action="/admin/add-admin">
      <input type="hidden" name="_csrf" value="<%= csrfToken %>">
      <div class="form-group">
        <label class="form-label" for="username">帳號</label>
        <input type="text" id="username" name="username" class="form-input" required maxlength="50">
      </div>
      <div class="form-group">
        <label class="form-label" for="password">密碼</label>
        <input type="password" id="password" name="password" class="form-input" required minlength="6">
        <p class="form-hint">至少 6 位</p>
      </div>
      <button type="submit" class="btn btn-primary">新增</button>
    </form>
  </div>

  <!-- Change Password -->
  <div class="section-card fade-up">
    <h2 class="section-title">更改密碼</h2>
    <form method="POST" action="/admin/change-password">
      <input type="hidden" name="_csrf" value="<%= csrfToken %>">
      <div class="form-group">
        <label class="form-label" for="currentPassword">現有密碼</label>
        <input type="password" id="currentPassword" name="currentPassword" class="form-input" required>
      </div>
      <div class="form-group">
        <label class="form-label" for="newPassword">新密碼</label>
        <input type="password" id="newPassword" name="newPassword" class="form-input" required minlength="6">
        <p class="form-hint">至少 6 位</p>
      </div>
      <button type="submit" class="btn btn-primary">更改密碼</button>
    </form>
  </div>

  <div class="mt-md">
    <a href="/admin" class="btn btn-outline">&#8592; 返回後台</a>
  </div>
</main>

<%- include('../partials/footer') %>
