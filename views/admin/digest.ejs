<%- include('../partials/head', { title: '代禱摘要', description: '代禱摘要 - 教會祈禱牆' }) %>
<%- include('../partials/header', { heroSubtitle: '代禱摘要' }) %>
<%- include('../partials/admin-nav', { activeAdmin: 'digest' }) %>

<main class="main">
  <div class="section-card fade-up">
    <h2 class="section-title">代禱摘要</h2>

    <p class="text-muted mb-md">
      生成日期：<%= dateStr %> &middot; 共 <%= prayerCount %> 個代禱事項
    </p>

    <div class="form-group">
      <label class="form-label">複製內容</label>
      <textarea id="digestTextArea" class="digest-textarea" readonly><%= digestText %></textarea>
    </div>

    <div style="display: flex; align-items: center; gap: 0.75rem;">
      <button id="copyBtn" type="button" class="btn btn-gold">全選並複製</button>
      <span class="copy-feedback" id="copySuccess">已複製！</span>
    </div>

  </div>

  <div class="mt-md">
    <a href="/admin" class="btn btn-outline">&#8592; 返回後台</a>
  </div>
</main>

<%- include('../partials/footer') %>

<script>
  document.getElementById('copyBtn').addEventListener('click', function() {
    var ta = document.getElementById('digestTextArea');
    if (!ta) return;
    try {
      ta.focus();
      ta.select();
      ta.setSelectionRange(0, 99999);
      var ok = document.execCommand('copy');
      if (ok) { showOk(); return; }
      if (navigator.clipboard && window.isSecureContext) {
        navigator.clipboard.writeText(ta.value).then(showOk).catch(function() {
          alert('複製失敗，請手動按 Ctrl+C');
        });
      } else {
        alert('文字已選取，請手動按 Ctrl+C');
      }
    } catch(e) { alert('發生錯誤: ' + e); }
  });

  function showOk() {
    var el = document.getElementById('copySuccess');
    el.style.display = 'inline';
    setTimeout(function() { el.style.display = 'none'; }, 2500);
  }
</script>
