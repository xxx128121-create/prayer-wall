<!DOCTYPE html>
<html lang="zh-HK">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ä»£ç¦±æ‘˜è¦ - æ•™æœƒç¥ˆç¦±ç‰†</title>
    <link rel="stylesheet" href="/css/style.css">
    <style>
        .digest-box {
            background: #f5f5f5;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            padding: 1rem;
            font-family: monospace;
            white-space: pre-wrap;
            word-wrap: break-word;
            font-size: 0.95rem;
            line-height: 1.6;
            min-height: 200px;
            margin-bottom: 1rem;
        }

        .copy-success {
            display: none;
            color: var(--color-success);
            font-weight: 600;
        }
    </style>
</head>

<body>
    <header class="header">
        <h1>ğŸ™ æ•™æœƒç¥ˆç¦±ç‰†</h1>
        <p>ä»£ç¦±æ‘˜è¦</p>
    </header>

    <nav class="nav">
        <a href="/">ğŸ“– ç¥ˆç¦±ç‰†</a>
        <a href="/submit">âœï¸ æäº¤ä»£ç¦±</a>
        <a href="/admin">âš™ï¸ ç®¡ç†å¾Œå°</a>
        <a href="/admin/digest" class="active">ğŸ“‹ ç”Ÿæˆæ‘˜è¦</a>
        <a href="/admin/settings">ğŸ‘¥ è¨­å®š</a>
    </nav>

    <main class="main">
        <div class="card fade-in">
            <h2 class="section-title">ğŸ“‹ ä»£ç¦±æ‘˜è¦</h2>

            <p style="margin-bottom: 1rem; color: var(--text-secondary);">
                ç”Ÿæˆæ—¥æœŸ: <%= dateStr %> | å…± <%= prayerCount %> å€‹ä»£ç¦±äº‹é …
            </p>

            <div style="margin-top: 1rem;">
                <p style="margin-bottom: 0.5rem; font-weight: bold;">è¤‡è£½å…§å®¹ï¼š</p>
                <textarea id="digestTextArea"
                    style="width: 100%; height: 300px; padding: 0.5rem; font-family: monospace; border: 1px solid #ccc; border-radius: 4px;"
                    readonly><%= digestText %></textarea>

                <div style="margin-top: 0.8rem; display: flex; align-items: center; gap: 1rem;">
                    <button id="copyBtn" type="button" class="btn btn-primary">
                        ğŸ“‹ å…¨é¸ä¸¦è¤‡è£½
                    </button>
                    <span class="copy-success" id="copySuccess">âœ… å·²è¤‡è£½ï¼</span>
                </div>
            </div>

            <div class="alert alert-info" style="margin-top: 1rem;">
                <strong>æç¤ºï¼š</strong> è¤‡è£½å¾Œå¯ä»¥ç›´æ¥è²¼å» WhatsApp ç¾¤çµ„åˆ†äº«ã€‚
            </div>
        </div>

        <div style="margin-top: 1rem;">
            <a href="/admin" class="btn btn-outline">â† è¿”å›å¾Œå°</a>
        </div>
    </main>

    <footer class="footer">
        <p>æ•™æœƒç¥ˆç¦±ç‰† &copy; <%= new Date().getFullYear() %>
        </p>
    </footer>

    <script>
        document.getElementById('copyBtn').addEventListener('click', function () {
            var textArea = document.getElementById('digestTextArea');
            if (!textArea) {
                alert('éŒ¯èª¤ï¼šæ‰¾ä¸åˆ°æ–‡å­—å€åŸŸ');
                return;
            }

            try {
                // Focus and select legacy way
                textArea.focus();
                textArea.select();
                textArea.setSelectionRange(0, 99999); // Mobile

                // Try execCommand
                var successful = document.execCommand('copy');

                if (successful) {
                    showSuccess();
                } else {
                    // Try Clipboard API
                    if (navigator.clipboard && window.isSecureContext) {
                        navigator.clipboard.writeText(textArea.value)
                            .then(showSuccess)
                            .catch(function (err) {
                                alert('è¤‡è£½å¤±æ•—ï¼Œè«‹æ‰‹å‹•æŒ‰ Ctrl+Cã€‚éŒ¯èª¤: ' + err);
                            });
                    } else {
                        alert('è¤‡è£½å¤±æ•— (Browser restricted)ï¼Œæ–‡å­—å·²é¸å–ï¼Œè«‹æ‰‹å‹•æŒ‰ Ctrl+C');
                    }
                }
            } catch (err) {
                alert('ç™¼ç”ŸéŒ¯èª¤: ' + err);
            }
        });

        function showSuccess() {
            var msg = document.getElementById('copySuccess');
            msg.style.display = 'inline';
            setTimeout(function () {
                msg.style.display = 'none';
            }, 3000);
        }
    </script>
</body>

</html>