<!DOCTYPE html>
<html lang="zh-HK">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ä»£ç¦±æ‘˜è¦ - æ•™æœƒç¥ˆç¦±ç‰†</title>
    <link rel="stylesheet" href="/css/style.css">
    <style>
        .digest-box {
            background: #f5f5f5;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            padding: 1rem;
            font-family: monospace;
            white-space: pre-wrap;
            word-wrap: break-word;
            font-size: 0.95rem;
            line-height: 1.6;
            min-height: 200px;
            margin-bottom: 1rem;
        }

        .copy-success {
            display: none;
            color: var(--color-success);
            font-weight: 600;
        }
    </style>
</head>

<body>
    <header class="header">
        <h1>ğŸ™ æ•™æœƒç¥ˆç¦±ç‰†</h1>
        <p>ä»£ç¦±æ‘˜è¦</p>
    </header>

    <nav class="nav">
        <a href="/">ğŸ“– ç¥ˆç¦±ç‰†</a>
        <a href="/submit">âœï¸ æäº¤ä»£ç¦±</a>
        <a href="/admin">âš™ï¸ ç®¡ç†å¾Œå°</a>
        <a href="/admin/digest" class="active">ğŸ“‹ ç”Ÿæˆæ‘˜è¦</a>
        <a href="/admin/settings">ğŸ‘¥ è¨­å®š</a>
    </nav>

    <main class="main">
        <div class="card fade-in">
            <h2 class="section-title">ğŸ“‹ ä»£ç¦±æ‘˜è¦</h2>

            <p style="margin-bottom: 1rem; color: var(--text-secondary);">
                ç”Ÿæˆæ—¥æœŸ: <%= dateStr %> | å…± <%= prayerCount %> å€‹ä»£ç¦±äº‹é …
            </p>

            <div class="digest-box" id="digestText">
                <%= digestText %>
            </div>

            <div style="display: flex; flex-direction: column; gap: 0.5rem; margin-top: 1rem;">
                <div style="display: flex; gap: 0.5rem; align-items: center;">
                    <button onclick="copyDigest()" class="btn btn-primary">
                        ğŸ“‹ è¤‡è£½åˆ°å‰ªè²¼æ¿
                    </button>
                    <span class="copy-success" id="copySuccess">âœ… å·²è¤‡è£½ï¼</span>
                </div>

                <div id="manualCopyArea" style="display: none;">
                    <p style="font-size: 0.9rem; color: var(--text-secondary); margin-bottom: 0.5rem;">å¦‚æœæŒ‰éˆ•ç„¡æ•ˆï¼Œè«‹æ‰‹å‹•è¤‡è£½ä»¥ä¸‹å…§å®¹ï¼š
                    </p>
                    <textarea id="digestTextAreaFallback" style="width: 100%; height: 150px; padding: 0.5rem;"
                        readonly></textarea>
                </div>
            </div>

            <div class="alert alert-info" style="margin-top: 1rem;">
                <strong>æç¤ºï¼š</strong> è¤‡è£½å¾Œå¯ä»¥ç›´æ¥è²¼å» WhatsApp ç¾¤çµ„åˆ†äº«ã€‚
                æ‘˜è¦åªåŒ…å«ç°¡çŸ­å…§å®¹ï¼ˆæœ€å¤š 50 å­—ï¼‰ï¼Œä¿è­·ä»£ç¦±è€…ç§éš±ã€‚
            </div>
        </div>

        <div style="margin-top: 1rem;">
            <a href="/admin" class="btn btn-outline">â† è¿”å›å¾Œå°</a>
        </div>
    </main>

    <footer class="footer">
        <p>æ•™æœƒç¥ˆç¦±ç‰† &copy; <%= new Date().getFullYear() %>
        </p>
    </footer>

    <script>
        function copyDigest() {
            var text = document.getElementById('digestText').innerText;

            // Try modern clipboard API first
            if (navigator.clipboard && window.isSecureContext) {
                navigator.clipboard.writeText(text).then(function () {
                    showCopySuccess();
                }).catch(function () {
                    fallbackCopy(text);
                });
            } else {
                fallbackCopy(text);
            }
        }

        function fallbackCopy(text) {
            var textArea = document.createElement('textarea');
            textArea.value = text;
            textArea.style.position = 'fixed';
            textArea.style.left = '-9999px';
            document.body.appendChild(textArea);
            textArea.select();
            try {
                var successful = document.execCommand('copy');
                if (successful) {
                    showCopySuccess();
                } else {
                    showManualCopy(text);
                }
            } catch (err) {
                showManualCopy(text);
            }
            document.body.removeChild(textArea);
        }

        function showManualCopy(text) {
            var manualArea = document.getElementById('manualCopyArea');
            var textAreaFallback = document.getElementById('digestTextAreaFallback');
            textAreaFallback.value = text;
            manualArea.style.display = 'block';
            textAreaFallback.select();
            alert('è‡ªå‹•è¤‡è£½å¤±æ•—ï¼Œè«‹æ‰‹å‹•è¤‡è£½é¡¯ç¤ºçš„æ–‡å­—ã€‚');
        }

        function showCopySuccess() {
            document.getElementById('copySuccess').style.display = 'inline';
            setTimeout(function () {
                document.getElementById('copySuccess').style.display = 'none';
            }, 3000);
        }
    </script>
</body>

</html>